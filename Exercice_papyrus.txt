1.Quelles sont les commandes du fournisseur n°9120 ?

USE papyrus;

SELECT fournis.numfou, numcom
FROM entcom
JOIN fournis ON fournis.numfou = entcom.numfou
WHERE fournis.numfou = '9120'
;



2.Afficher le code des fournisseurs pour lesquels des commandes ont été passées.

USE papyrus;

SELECT numfou
FROM entcom
;

3.Afficher le nombre de commandes fournisseurs passées, et le nombre de fournisseur concernés.

USE papyrus;

SELECT nomfou, COUNT(*) AS 'nb commande'
FROM ligcom
JOIN entcom ON entcom.numcom = ligcom.numcom
JOIN fournis ON fournis.numfou = entcom.numfou
GROUP BY nomfou
;


4.Extraire les produits ayant un stock inférieur ou égal au stock d'alerte, et dont la quantité annuelle est inférieure à 1000. 

USE papyrus;

SELECT codart AS 'N° produit', libart AS 'Libellé produit', stkale AS 'Stock actuelle', stkphy AS 'Stock d\'alerte', qteann AS 'Quantité annuelle'
FROM produit
WHERE stkale <= stkphy AND qteann < 1000
;


5.Quels sont les fournisseurs situés dans les départements 75, 78, 92, 77 ? 

USE papyrus;

SELECT posfou, nomfou
FROM fournis
WHERE posfou REGEXP('(75|78|92|77)')
ORDER BY posfou ASC, nomfou DESC 
;


6.Quelles sont les commandes passées en mars et en avril ?

USE papyrus; 
 
SELECT numcom 
FROM entcom 
WHERE MONTH(datcom) IN (3, 4)
;


7.Quelles sont les commandes du jour qui ont des observations particulières ? 


USE papyrus;

SELECT numcom, datcom
FROM entcom
WHERE obscom != ''
;

8.Lister le total de chaque commande par total décroissant. 

USE papyrus;

SELECT numcom, (qtecde * priuni) AS 'Total commande(€)'
FROM ligcom
ORDER BY priuni DESC
;


9.Lister les commandes dont le total est supérieur à 10000€ ; on exclura dans le calcul du total les articles commandés en quantité supérieure ou égale à 1000. 

USE papyrus;

SELECT numcom, (qtecde * priuni) AS 'Total commande(€)'
FROM ligcom
WHERE (qtecde * priuni) > 10000 AND qtecde < 1000
ORDER BY priuni DESC
;



10.Lister les commandes par nom de fournisseur. 

USE papyrus;

SELECT nomfou, entcom.numcom, datcom
FROM ligcom
JOIN entcom ON entcom.numcom = ligcom.numcom
JOIN fournis ON fournis.numfou = entcom.numfou
GROUP BY nomfou
;

11.Sortir les produits des commandes ayant le mot "urgent' en observation. 

USE papyrus;

SELECT ligcom.numcom, nomfou, libart, (qtecde * priuni) AS 'Total commande(€)'
FROM produit
JOIN ligcom ON ligcom.codart = produit.codart
JOIN entcom ON entcom.numcom = ligcom.numcom
JOIN fournis ON fournis.numfou = entcom.numfou
WHERE obscom LIKE '%urgent%'
;


12.Coder de 2 manières différentes la requête suivante : Lister le nom des fournisseurs susceptibles de livrer au moins un article.

a.

USE papyrus;

SELECT DISTINCT nomfou, COUNT(*) AS 'Nb Commandes'
FROM ligcom
JOIN entcom ON entcom.numcom = ligcom.numcom
JOIN fournis ON fournis.numfou = entcom.numfou
GROUP BY nomfou
;

b.

USE papyrus;

SELECT DISTINCT nomfou
FROM entcom
JOIN fournis ON fournis.numfou = entcom.numfou
;


13.Coder de 2 manières différentes la requête suivante : Lister les commandes dont le fournisseur est celui de la commande n°70210. 

a.

USE papyrus;

SELECT DISTINCT numcom, datcom
FROM entcom
WHERE numfou = 120
;


b.

USE papyrus;

SELECT DISTINCT numcom, datcom
FROM entcom
WHERE numfou = (
	SELECT numfou
	FROM entcom
	WHERE numcom = 70210
)
;


14.Dans les articles susceptibles d’être vendus, lister les articles moins chers (basés sur Prix1) que le moins cher des rubans (article dont le premier caractère commence par R). 


USE papyrus;

SELECT libart, prix1
FROM produit
JOIN vente ON vente.codart = produit.codart
WHERE prix1 < (
	SELECT prix1
	FROM vente
	WHERE codart = 'R080'
	)
GROUP BY libart
;


15.Sortir la liste des fournisseurs susceptibles de livrer les produits dont le stock est inférieur ou égal à 150 % du stock d'alerte. 

USE papyrus;

SELECT DISTINCT nomfou AS 'Fournisseur', libart AS 'Produit'
FROM produit
JOIN vente ON vente.codart = produit.codart
JOIN fournis ON fournis.numfou = vente.numfou
WHERE stkale <= (stkphy * 1.5)
ORDER BY libart ASC, nomfou ASC
;


16.Sortir la liste des fournisseurs susceptibles de livrer les produits dont le stock est inférieur ou égal à 150 % du stock d'alerte, et un délai de livraison d'au maximum 30 jours. 

USE papyrus;

SELECT DISTINCT nomfou AS 'Fournisseur', libart AS 'Produit'
FROM produit
JOIN vente ON vente.codart = produit.codart
JOIN fournis ON fournis.numfou = vente.numfou
WHERE stkale <= (stkphy * 1.5) AND delliv <= 30
ORDER BY nomfou ASC, libart ASC
;


17.Avec le même type de sélection que ci-dessus, sortir un total des stocks par fournisseur, triés par total décroissant.

USE papyrus;

SELECT nomfou, SUM(stkale)
FROM produit
JOIN vente ON vente.codart = produit.codart
JOIN fournis ON fournis.numfou = vente.numfou
GROUP BY nomfou
ORDER BY SUM(stkale) DESC 
;


18.En fin d'année, sortir la liste des produits dont la quantité réellement commandée dépasse 90% de la quantité annuelle prévue.

USE papyrus;

SELECT YEAR(derliv) AS 'Année', libart, (qteliv - (qteann * 0.9)) AS 'Nb de produit > 90%'
FROM produit
JOIN ligcom ON ligcom.codart = produit.codart
WHERE qteliv > (qteann * 0.9)
;


19.Calculer le chiffre d'affaire par fournisseur pour l'année 2018, sachant que les prix indiqués sont hors taxes et que le taux de TVA est 20%.

USE papyrus;

SELECT nomfou,SUM((priuni * qtecde)* 1.2) AS 'CA', '€' AS 'Unité monétaire'
FROM ligcom
JOIN entcom ON entcom.numcom = ligcom.numcom
JOIN fournis ON fournis.numfou = entcom.numfou
GROUP BY nomfou
;







